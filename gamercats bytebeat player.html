<!DOCTYPE html>
<html>
<head>
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<title>Gamercats bytebeat comsper</title>
	<style>
	  body {
	    text-align: center;
	    background-color: #000000;
	    color: white;
	    font-family: Courier, monospace;
	  }
	    
	  button {
        background-color: transparent;
        border: 2px solid white;
        color: white;
        font-family: Courier, monospace;
    }
    
    input, textarea {
      background-color: transparent;
      border: 2px solid white;
      color: white;
      font-family: Courier, monospace;
    }
    
    select, option {
      background-color: transparent;
      border: 2px solid white;
      color: white;
      font-family: Courier, monospace;
    }
    
    #backgroundInput {
      background-color: transparent;
      border: 2px solid white;
      color: white;
      font-family: Courier, monospace;
    }
    
    #formula {
      width: 300px;
      height: 150px;
    }
	</style>
</head>
<body>
	<h1>Gamercats bytebeat comsper</h1>
	<label>Formula:</label>
	<div>
		<textarea id="formula">(t/(4+(t>>13&3))*64|t>>(t>>12&15))+4E5/(t&4095)|t>>4</textarea>
	</div><br>
	<div>
	<label for="sampleRate">Sample Rate:</label>
<select id="sampleRate">
  <option value="8000">8000</option>
  <option value="11025">11025</option>
  <option value="16000">16000</option>
  <option value="22050">22050</option>
  <option value="32000">32000</option>
  <option value="44100">44100</option>
  <option value="48000">48000</option>
  <option value="64000">64000</option>
</select><br>
  <div>
    <label for="duration">Duration:</label>
    <input type="number" id="duration" value="20" min="1">
  </div>
  </div><br>
  <div>
	<button onclick="play()">play</button>
	<button onclick="stop()">pause</button>
    <label>Bytebeat music (or one-liner music) was invented in September 2011. They're generally a piece of rhythmic and somewhat melodic music with no score, no instruments, and no real oscillators. It's simply a single-line formula that defines a waveform as a function of time, processed (usually) 8000 times per second, resulting in an audible waveform with a 256-step resolution from silence (0) to full amplitude (256). If you put that script into a program with a loop that increments time variable (t), you can generate the headerless unsigned 8 bit mono 8kHz audio stream on output, like in this application. Note that you need to set the duration of the generated bytebeat so that it doesn't end itself.</label>
    </div><br>
    <div>
    <label>New to bytebeat? Check out this <a href="https://www.youtube.com/watch?v=K4GsZu8kBbw" target="_blank">tutorial</a>.</label>
    </div><br>
    <div>
    <label><a href="http://canonical.org/~kragen/bytebeat/" target="_blank">History of bytebeat</a></label>
    </div><br>
    

    <a href="https://forms.gle/aqcSXHETbUhbWcFL8" target="_blank">Owner library</a>
    
    <a href="https://forms.gle/NeQ68S1DD2sbmhVz6" target="_blank">submit your bytebeat</a>
    
    <h1>Customization</h1><br>
    
    	<select id="bgCol">
	<option value="#000000">Default</option>
	<option value="#00AA00">Green</option>
	<option value="#0020AA">Blue</option>
	<option value="#00AAAA">Cyan</option>
	<option value="#AA0000">Red</option>
	<option value="#B45100">Orange</option>
	<option value="#A4BD47">Yellowish Green</option>
	<option value="#008080">Windows 95</option>
	<option value="#005CA9">Windows 2000</option>
	<option value="#6E00E6">Purple</option>
	<option value="#E600E6">Pink</option>
	<option value="#DDDDDD">White</option>
	<option value="#606060">Gray</option>
	<option value="#002000">Dark Green</option>
	<option value="#AAAA00">Yellow</option>
	<option value="#550000">Maroon</option>
	</select>
	
	<select id="txtCol">
	<option value="#FFFFFF">White</option>
	<option value="#000000">Black</option>
	<option value="#00AA00">Green</option>
	<option value="#0020AA">Blue</option>
	<option value="#00AAAA">Cyan</option>
	<option value="#AA0000">Red</option>
	<option value="#B45100">Orange</option>
	<option value="#A4BD47">Yellowish Green</option>
	<option value="#008080">Windows 95</option>
	<option value="#005CA9">Windows 2000</option>
	<option value="#6E00E6">Purple</option>
	<option value="#E600E6">Pink</option>
	<option value="#606060">Gray</option>
	<option value="#002000">Dark Green</option>
	<option value="#AAAA00">Yellow</option>
	<option value="#550000">Maroon</option>
	</select>

    <select id="FontCh">
	<option value="Courier">Default (Courier)</option>
	<option value="Consolas">Consolas</option>
	<option value="Comic Sans MS">Comic Sans</option>
	<option value="Arial">Arial</option>
	<option value="Times New Roman">Roman</option>
	</select>
	
	<input type="file" id="backgroundInput" accept="image/*">
    <button onclick="changeBackground()">Apply</button>
	<br>
    
	<script>
	  document.getElementById("bgCol").addEventListener("change", function() {
    var col1 = this.value;
      document.body.style.backgroundColor = col1;
  });
  
  document.getElementById("txtCol").addEventListener("change", function() {
    var col = this.value;
      document.body.style.color = col;
      document.getElementById("formula").style.color = col;
      document.getElementById("sampleRate").style.color = col;
      document.getElementById("duration").style.color = col;
      document.getElementById("FontCh").style.color = col;
      document.getElementById("bgCol").style.color = col;
      document.getElementById("backgroundInput").style.color = col;
      document.getElementById("txtCol").style.color = col;
  });
  
document.getElementById("FontCh").addEventListener("change", function() {
  var font = this.value;
  document.body.style.setProperty('font-family', font);
  document.getElementById("formula").style.setProperty('font-family', font);
  document.getElementById("sampleRate").style.setProperty('font-family', font);
  document.getElementById("duration").style.setProperty('font-family', font);
  document.getElementById("FontCh").style.setProperty('font-family', font);
  document.getElementById("bgCol").style.setProperty('font-family', font);
  document.getElementById("backgroundInput").style.setProperty('font-family', font);
  document.getElementById("txtCol").style.setProperty('font-family', font);
  
  var playButtons = document.querySelectorAll(".play");
  playButtons.forEach(function(button) {
    button.style.setProperty('font-family', font);
  });
  
  var stopButtons = document.querySelectorAll(".stop");
  stopButtons.forEach(function(button) {
    button.style.setProperty('font-family', font);
  });
});

function changeBackground() {
            const fileInput = document.getElementById('backgroundInput');
            const file = fileInput.files[0];
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    document.body.style.backgroundImage = `url('${e.target.result}')`;
                };

                reader.readAsDataURL(file);
            } else {
              if (Math.floor(Math.random() * 2) === 1) {
                alert('Insert cash or select payment type.');
              }
              if (Math.floor(Math.random() * 2) === 2) {
                alert('Invalid image!');
              }
            }
        };
	
let audioCtx;
let source;

function play() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  source = audioCtx.createBufferSource();

  let formula = document.getElementById("formula").value;
  let sampleRate = document.getElementById("sampleRate").value;
  let duration = document.getElementById("duration").value;

  let buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * duration, sampleRate);
  let data = buffer.getChannelData(0);

  for (let t = 0; t < buffer.length; t++) {
    let time = t / audioCtx.sampleRate;
    let value = eval(formula);
    data[t] = (value & 255) / 127 - 1;
  }